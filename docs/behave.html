<!DOCTYPE html>  <html> <head>   <title>behave.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               behave.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>behave.js  
For all details and documentation:
http://github.com/kennknowles/behave.js
Copyright 2012 Kenneth Knowles

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Behave.js: Less-than-pure Functional Reactive Programming with Behaviors and Event Streams</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span> <span class="c1">// The page, or whatever</span>

    <span class="kd">var</span> <span class="nx">Be</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Behave</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// The module</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Functional helpers</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="kd">var</span> <span class="nx">constfun</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">val</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Event Streams</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>An event stream can be subscribed to, and the subscription canceled.</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Subscription = { cancel :: IO ()  }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">Subscription</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">implementation</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">cancel</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">cancel</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>EventStream a = { subscribe :: (a -> IO ()) -> IO Subscription } </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">implementation</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>functor</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">map</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">({</span>
		<span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">});</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>monoid - all events from each stream</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">merge</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">({</span>
		<span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="kd">var</span> <span class="nx">thisSub</span>  <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
		    <span class="kd">var</span> <span class="nx">otherSub</span> <span class="o">=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

		    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Subscription</span><span class="p">({</span>
			<span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			    <span class="nx">thisSub</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
			    <span class="nx">otherSub</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
			<span class="p">}</span>
		    <span class="p">});</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span>
    <span class="p">});</span>
    </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>heartbeat :: EventStream () -- no value associated with it so it is time-translation-invariant</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">heartbeat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">millis</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">({</span>
	    <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">millis</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Subscription</span><span class="p">({</span>
		    <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
			<span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">});</span>
	    <span class="p">},</span>
	<span class="p">});</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h2>Behaviors</h2>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>A Behavior is a continuously changing value. It can be observed by the series of change events, polled or pushed
depending on the implementation.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Options are also dependent on the sort of behavior, but behaviors will naturally
be composed so here are some expected ones:</p>

<p>pollMillis: the period of polling for behaviors requiring it
debounceMillis: the debounce duration for push-based events (you can also debounce your callback)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Behavior a :: { changes :: options -> Eventstream a }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">implementation</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">changes</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">changes</span>
    <span class="p">}</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>functor</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">map</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">({</span>
		<span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">changes</span><span class="p">(</span><span class="nx">options</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>applicative - TODO</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="cm">/*</span>
<span class="cm">	ap: function(argsB) {</span>
<span class="cm">	    return new Be.Behavior(function(delay) {</span>
<span class="cm">		return this.poll(delay).merge(argsB.poll(delay))</span>
<span class="cm">	    });</span>
<span class="cm">	    ...</span>
<span class="cm">	    },</span>
<span class="cm">	*/</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>constant :: a -> Behavior a -- constant behavior that never wastes time polling or sending updates</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">constant</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">({</span>
	    <span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">({</span>
		    <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Subscription</span><span class="p">({</span>
			    <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
			<span class="p">});</span>
		    <span class="p">}</span>
		<span class="p">});</span>
	    <span class="p">}</span>
	<span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">Be</span><span class="p">.</span><span class="nx">time</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">({</span>
	<span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">heartbeat</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">pollMillis</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span> <span class="p">});</span>
	<span class="p">},</span>
    <span class="p">});</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Observables</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>An observable is a behavior that definitively has a current value, so it has a getter and setter
that cause the behavior to change.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Observable a = { get :: IO a, set :: a -> IO (), changes :: millis -> EventStream a }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">Observable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">implementation</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">get</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">set</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">changes</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">changes</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Be</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>get followed by set</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">modify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">()));</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">Be</span><span class="p">.</span><span class="nx">variable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">initialValue</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">initialValue</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">subscriptions</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Observable</span><span class="p">({</span>
	    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
	    <span class="p">},</span>

	    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">value</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
		<span class="nx">_</span><span class="p">(</span><span class="nx">subscriptions</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nx">callback</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
		<span class="p">});</span>
	    <span class="p">},</span>

	    <span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">({</span>
		    <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">chain</span><span class="p">(</span><span class="nx">subscriptions</span><span class="p">).</span><span class="nx">keys</span><span class="p">().</span><span class="nx">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="nx">subscriptions</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Subscription</span><span class="p">({</span>
			    <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">delete</span> <span class="nx">subscriptions</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
			    <span class="p">}</span>
			<span class="p">});</span>
		    <span class="p">}</span>
		<span class="p">});</span>
	    <span class="p">}</span>
	<span class="p">});</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Sinks</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>A sink is something that will react by mutating the world, such as the DOM or a Backbone model. 
I haven't made a class for this, since it doesn't really have many meaningful combinators...</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Sink a = a -> IO ()</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>A sink which writes the incoming value as the contents of the jquery DOM node</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">domSink</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">elem</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Uses jquery, but there's nothing jquery specific about the interface</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">inputSink</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">elem</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>A sink which does knockout-style data-bind for a form. Assumes a backbone-style model object and jquery style elem.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">formSink</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">elem</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[data-bind]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">(</span><span class="nx">input</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">input</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-bind&#39;</span><span class="p">)));</span>
	    <span class="p">});</span>
	<span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h2>Adapters</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Batteries included.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>backboneE(obj, event) creates an event stream out of the particular event you <em>could</em> bind with backbone events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneE</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">EventStream</span><span class="p">({</span>
	    <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">obj</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Subscription</span><span class="p">({</span>
		    <span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">obj</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		    <span class="p">},</span>
		<span class="p">});</span>
	    <span class="p">},</span>
	<span class="p">});</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>backboneCollectionB(collection) creates a behavior of the collection object itself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneCollectionB</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">adds</span> <span class="o">=</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneE</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">removes</span> <span class="o">=</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneE</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="s2">&quot;remove&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">resets</span> <span class="o">=</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneE</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">({</span>
	    <span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">adds</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">removes</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">resets</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">constfun</span><span class="p">(</span><span class="nx">collection</span><span class="p">))</span> <span class="p">},</span>
	<span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneModelB</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneE</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">({</span>
	    <span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">changes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">constfun</span><span class="p">(</span><span class="nx">model</span><span class="p">));</span> <span class="p">}</span>
	<span class="p">});</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Actually the same</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">jqueryE</span> <span class="o">=</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">backboneE</span><span class="p">;</span>

    <span class="nx">Be</span><span class="p">.</span><span class="nx">jqueryInputB</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">jqueryE</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;keypress&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">Be</span><span class="p">.</span><span class="nx">jqueryE</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">))</span>
            <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">Be</span><span class="p">.</span><span class="nx">jqueryE</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;keydown&quot;</span><span class="p">));</span> <span class="c1">// catch backspace with keyup</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Behavior</span><span class="p">({</span>
	    <span class="nx">changes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">changes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span> <span class="p">})</span> <span class="p">},</span>
	<span class="p">});</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h2>Futures</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>A future is an event stream that has only one event in it. Kind of pointless, here...</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Future a = { await :: a -> IO () }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Be</span><span class="p">.</span><span class="nx">Future</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">implementation</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">await</span> <span class="o">=</span> <span class="nx">implementation</span><span class="p">.</span><span class="nx">await</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Be</span><span class="p">.</span><span class="nx">Future</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>monoid: this.or(that) is the earlier of the two futures</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">or</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Future</span><span class="p">({</span>
		<span class="nx">await</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="kd">var</span> <span class="nx">arrived</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		    <span class="nx">self</span><span class="p">.</span><span class="nx">await</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arrived</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="nx">arrived</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span> <span class="p">});</span>
		    <span class="nx">other</span><span class="p">.</span><span class="nx">await</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arrived</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="nx">arrived</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span> <span class="p">});</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>functor: this.map(f) "occurs" at the same time as this value</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">map</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Future</span><span class="p">({</span>
		<span class="nx">await</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nx">self</span><span class="p">.</span><span class="nx">await</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span> <span class="p">});</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>monad: this.bind(f) "occurs" at the later of this value and the bound value</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Future</span><span class="p">({</span>
		<span class="nx">await</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nx">self</span><span class="p">.</span><span class="nx">await</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">callback</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>
		    <span class="p">});</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>applicative: this.ap(args) "occurs" at the later (induced by monad, but reimplemented to elide some allocation)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">ap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argsFuture</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">Be</span><span class="p">.</span><span class="nx">Future</span><span class="p">({</span>
		<span class="nx">await</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nx">self</span><span class="p">.</span><span class="nx">await</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">argsFuture</span><span class="p">.</span><span class="nx">await</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
			    <span class="nx">callback</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">args</span><span class="p">));</span>
			<span class="p">});</span>
		    <span class="p">});</span>
		<span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">},</span>
    <span class="p">});</span>
<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 